<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils: https://docutils.sourceforge.io/" />
<title>README.rst</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 9511 2024-01-13 09:50:07Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.
Despite the name, some widely supported CSS2 features are used.

See https://docutils.sourceforge.io/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: gray; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic, pre.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<a class="reference external image-reference" href="https://odoo-community.org/get-involved?utm_source=readme">
<img alt="Odoo Community Association" src="https://odoo-community.org/readme-banner-image" />
</a>
<div class="section" id="mdf-e-abstract-models">
<h1>MDF-e abstract models</h1>
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!! This file is generated by oca-gen-addon-readme !!
!! changes will be overwritten.                   !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!! source digest: sha256:00b34f09bf437f5ab96abb4b9b19b9a78dcb8295335af77100972dd38cc23ed8
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<p><a class="reference external image-reference" href="https://odoo-community.org/page/development-status"><img alt="Production/Stable" src="https://img.shields.io/badge/maturity-Production%2FStable-green.png" /></a> <a class="reference external image-reference" href="http://www.gnu.org/licenses/lgpl-3.0-standalone.html"><img alt="License: LGPL-3" src="https://img.shields.io/badge/license-LGPL--3-blue.png" /></a> <a class="reference external image-reference" href="https://github.com/OCA/l10n-brazil/tree/16.0/l10n_br_mdfe_spec"><img alt="OCA/l10n-brazil" src="https://img.shields.io/badge/github-OCA%2Fl10n--brazil-lightgray.png?logo=github" /></a> <a class="reference external image-reference" href="https://translation.odoo-community.org/projects/l10n-brazil-16-0/l10n-brazil-16-0-l10n_br_mdfe_spec"><img alt="Translate me on Weblate" src="https://img.shields.io/badge/weblate-Translate%20me-F47D42.png" /></a> <a class="reference external image-reference" href="https://runboat.odoo-community.org/builds?repo=OCA/l10n-brazil&amp;target_branch=16.0"><img alt="Try me on Runboat" src="https://img.shields.io/badge/runboat-Try%20me-875A7B.png" /></a></p>
<p>Este módulo é a fundação para a emissão do Manifesto Eletrônico de
Documentos Fiscais (<tt class="docutils literal"><span class="pre">MDF-e</span></tt>, <tt class="docutils literal">modelo 58</tt>) no Odoo, fornecendo uma
estrutura de dados completa e fiel ao leiaute oficial 3.00 da SEFAZ.</p>
<p>É importante entender que este módulo atua como uma biblioteca de
modelos abstratos (mixins) e não realiza a emissão do MDF-e por si só.
Sua finalidade é ser a base para um módulo de implementação, como o
<tt class="docutils literal">l10n_br_mdfe</tt>, que é responsável por mapear esses modelos nos
documentos fiscais do Odoo (<tt class="docutils literal">l10n_br_fiscal.document</tt>) e comunicar-se
com os web services da SEFAZ. Esta arquitetura, que separa a estrutura
de dados da lógica de emissão, é a mesma utilizada com sucesso nos
módulos da Nota Fiscal Eletrônica (<tt class="docutils literal">l10n_br_nfe_spec</tt> e
<tt class="docutils literal">l10n_br_nfe</tt>).</p>
<p>O MDF-e é um documento fiscal que agrega e vincula múltiplos documentos
(como NF-e e CT-e) que acobertam uma carga transportada em um único
veículo, simplificando a fiscalização durante o percurso.</p>
<div class="section" id="principais-conceitos-e-estrutura-do-mdf-e">
<h2>Principais Conceitos e Estrutura do MDF-e</h2>
<p>O módulo <tt class="docutils literal">l10n_br_mdfe_spec</tt> mapeia com precisão a estrutura
hierárquica do manifesto. Os conceitos mais importantes implementados
são:</p>
<ul class="simple">
<li>Agrupamento por Município de Descarregamento (<tt class="docutils literal">infMunDescarga</tt>):
Esta é a principal lógica organizacional de um MDF-e. O módulo permite
agrupar todos os documentos fiscais (NF-e e CT-e) que serão entregues
em um mesmo município, garantindo a correta montagem do XML.</li>
<li>Documentos Vinculados: Dentro de cada município de descarregamento, é
possível vincular:<ul>
<li>Conhecimentos de Transporte (<tt class="docutils literal">infCte</tt>): Para operações onde o
emitente é um prestador de serviço de transporte.</li>
<li>Notas Fiscais (<tt class="docutils literal">infNFe</tt>): Para operações de transporte de carga
própria ou por transportadoras que realizarão a emissão de CT-e
Globalizado posteriormente.</li>
<li>Manifestos Anteriores (<tt class="docutils literal">infMDFeTransp</tt>): Utilizado em operações
específicas do modal aquaviário.</li>
</ul>
</li>
<li>Totalizadores (<tt class="docutils literal">tot</tt>): O módulo contém modelos para totalizar a
carga, incluindo a quantidade de documentos, o valor total da carga e
o peso bruto total.</li>
<li>Seguro da Carga (<tt class="docutils literal">seg</tt>): Estruturas para informar os dados do
seguro, o responsável (emitente ou contratante), a seguradora e os
números de apólice e averbação.</li>
</ul>
</div>
<div class="section" id="estrutura-por-modal-de-transporte">
<h2>Estrutura por Modal de Transporte</h2>
<p>O MDF-e exige informações distintas para cada modalidade de transporte.
O <tt class="docutils literal">l10n_br_mdfe_spec</tt> oferece modelos de dados específicos para cada
um deles:</p>
<ul class="simple">
<li>Rodoviário (<tt class="docutils literal">mdfe.30.rodo</tt>): É o mais detalhado, incluindo:<ul>
<li><tt class="docutils literal">infANTT</tt>: Informações para a Agência Nacional de Transportes
Terrestres, como o RNTRC.</li>
<li><tt class="docutils literal">infCIOT</tt>: Para o Código Identificador da Operação de Transporte.</li>
<li><tt class="docutils literal">valePed</tt>: Para o Vale-Pedágio obrigatório.</li>
<li><tt class="docutils literal">infContratante</tt> e <tt class="docutils literal">infPag</tt>: Para identificar os contratantes e
detalhar as informações de pagamento do frete.</li>
<li><tt class="docutils literal">veicTracao</tt>, <tt class="docutils literal">veicReboque</tt>, <tt class="docutils literal">condutor</tt>: Modelos para detalhar
os veículos da composição e seus respectivos condutores.</li>
</ul>
</li>
<li>Aéreo (<tt class="docutils literal">mdfe.30.aereo</tt>): Contempla campos para o número do voo
(<tt class="docutils literal">nVoo</tt>), e os códigos IATA/OACI dos aeródromos de embarque
(<tt class="docutils literal">cAerEmb</tt>) e destino (<tt class="docutils literal">cAerDes</tt>).</li>
<li>Aquaviário (<tt class="docutils literal">mdfe.30.aquav</tt>): Aborda dados como o IRIN, o número da
viagem (<tt class="docutils literal">nViag</tt>), os portos e terminais de embarque, descarregamento
e transbordo, além de informações do comboio.</li>
<li>Ferroviário (<tt class="docutils literal">mdfe.30.ferrov</tt>): Permite detalhar as informações do
trem (prefixo, origem, destino) e de cada vagão da composição.</li>
</ul>
</div>
<div class="section" id="geracao-de-codigo-automatizada">
<h2>Geração de Código Automatizada</h2>
<p>A principal característica deste módulo é que 100% dos seus modelos de
dados Odoo são gerados automaticamente a partir dos esquemas XSD
oficiais, publicados pelo Portal do MDF-e. Essa geração pelo xsdata-odoo
garante máxima fidelidade aos leiautes fiscais e agilidade na
atualização para novas versões.</p>
<p>Embora os esquemas XSD oficiais do MDF-e sejam publicados e mantidos no
Portal da SEFAZ, a arquitetura deste projeto se apoia na biblioteca
<tt class="docutils literal">nfelib</tt> para a tarefa de serialização dos dados em XML. Para
facilitar o processo de desenvolvimento e garantir a consistência, a
própria nfelib armazena em seu repositório uma cópia atualizada desses
esquemas oficiais.</p>
<p>Portanto, a prática recomendada para (re)gerar os modelos deste módulo é
utilizar um clone local do repositório da <tt class="docutils literal">nfelib</tt> como fonte para os
arquivos de esquema (.xsd), direcionando o comando do <tt class="docutils literal"><span class="pre">xsdata-odoo</span></tt>
para o diretório correspondente.</p>
<p>Links:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/akretion/xsdata-odoo">GitHub - akretion/xsdata-odoo: Odoo abstract model generator from xsd
schemas using xsdata</a></li>
<li><a class="reference external" href="https://github.com/akretion/nfelib">GitHub - akretion/nfelib: nfelib - bindings Python para e ler e gerir
XML de NF-e, NFS-e nacional, CT-e, MDF-e,
BP-e</a></li>
</ul>
<p>O comando utilizado para gerar os modelos da versão 3.0 do MDF-e foi:</p>
<pre class="code bash literal-block">
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/akretion/nfelib<span class="w">
</span><span class="nb">cd</span><span class="w"> </span>nfelib<span class="w">
</span><span class="nb">export</span><span class="w"> </span><span class="nv">XSDATA_SCHEMA</span><span class="o">=</span>mdfe<span class="w">
</span><span class="nb">export</span><span class="w"> </span><span class="nv">XSDATA_VERSION</span><span class="o">=</span><span class="m">30</span><span class="w">
</span><span class="nb">export</span><span class="w"> </span><span class="nv">XSDATA_LANG</span><span class="o">=</span><span class="s2">&quot;portuguese&quot;</span><span class="w">

</span>xsdata<span class="w"> </span>generate<span class="w"> </span>nfelib/mdfe/schemas/v3_0<span class="w"> </span><span class="se">\
</span><span class="w">  </span>--package<span class="w"> </span>nfelib.mdfe.odoo.v3_0<span class="w"> </span><span class="se">\
</span><span class="w">  </span>--output<span class="o">=</span>odoo
</pre>
</div>
<div class="section" id="prefixo-dos-campos-e-versao">
<h2>Prefixo dos campos e versão</h2>
<p>Com mais de 500 campos fiscais apenas no MDF-e, com uma meia dúzia de
documentos fiscais complexos, com 3000 módulos OCA, existiria um risco
real de conflito com os nomes de campos vindo dos esquemas. Além disso,
temos várias versões do MDF-e, a 2.0, a 3.0…</p>
<p>Nisso foi decidido que cada campo tem um prefixo composto do nome do
schema e de alguns dígitos da versão do esquema. No caso mdfe30_. A
escolha de 2 dígitos permite que uma atualização menor do esquema use os
mesmos campos (e dados no banco então) e que um simples update Odoo
(–update=…) consiga resolver a migração. Enquanto que para uma
mudança maior como de 3.0 para 4.0, seria assumido de usar novos campos
e novas tabelas (para os objetos não Odoo) e que a lib nfelib iria
trabalhar com os campos da versão maior do documento fiscal considerado.</p>
<p><strong>Table of contents</strong></p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#bug-tracker" id="toc-entry-1">Bug Tracker</a></li>
<li><a class="reference internal" href="#credits" id="toc-entry-2">Credits</a></li>
</ul>
</div>
<div class="section" id="bug-tracker">
<h3><a class="toc-backref" href="#toc-entry-1">Bug Tracker</a></h3>
<p>Bugs are tracked on <a class="reference external" href="https://github.com/OCA/l10n-brazil/issues">GitHub Issues</a>.
In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us to smash it by providing a detailed and welcomed
<a class="reference external" href="https://github.com/OCA/l10n-brazil/issues/new?body=module:%20l10n_br_mdfe_spec%0Aversion:%2016.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**">feedback</a>.</p>
<p>Do not contact contributors directly about support or help with technical issues.</p>
</div>
<div class="section" id="credits">
<h3><a class="toc-backref" href="#toc-entry-2">Credits</a></h3>
</div>
</div>
<div class="section" id="authors">
<h2>Authors</h2>
<ul class="simple">
<li>Akretion</li>
</ul>
</div>
<div class="section" id="contributors">
<h2>Contributors</h2>
<ul class="simple">
<li><a class="reference external" href="https://akretion.com/pt-BR">Akretion</a>:<ul>
<li>Raphaël Valyi &lt;<a class="reference external" href="mailto:raphael.valyi&#64;akretion.com.br">raphael.valyi&#64;akretion.com.br</a>&gt;</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="maintainers">
<h2>Maintainers</h2>
<p>This module is maintained by the OCA.</p>
<a class="reference external image-reference" href="https://odoo-community.org">
<img alt="Odoo Community Association" src="https://odoo-community.org/logo.png" />
</a>
<p>OCA, or the Odoo Community Association, is a nonprofit organization whose
mission is to support the collaborative development of Odoo features and
promote its widespread use.</p>
<p>Current <a class="reference external" href="https://odoo-community.org/page/maintainer-role">maintainer</a>:</p>
<p><a class="reference external image-reference" href="https://github.com/rvalyi"><img alt="rvalyi" src="https://github.com/rvalyi.png?size=40px" /></a></p>
<p>This module is part of the <a class="reference external" href="https://github.com/OCA/l10n-brazil/tree/16.0/l10n_br_mdfe_spec">OCA/l10n-brazil</a> project on GitHub.</p>
<p>You are welcome to contribute. To learn how please visit <a class="reference external" href="https://odoo-community.org/page/Contribute">https://odoo-community.org/page/Contribute</a>.</p>
</div>
</div>
</div>
</body>
</html>
